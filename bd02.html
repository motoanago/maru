<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>月別誕生日表示</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 10px;
      padding: 0 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    h2 {
      text-align: center;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1.1rem;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      margin-bottom: 20px;
    }
    button:hover {
      background-color: #45a049;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    select {
      width: 100%;
      font-size: 1rem;
      padding: 8px 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    #dataList ul {
      padding-left: 20px;
    }
    #dataList li {
      margin-bottom: 8px;
      word-break: break-word;
      font-size: 1rem;
    }
    @media (min-width: 480px) {
      select {
        width: auto;
        min-width: 200px;
      }
      button {
        width: auto;
        min-width: 120px;
        display: inline-block;
      }
    }
  </style>
</head>
<body>
  <h2>誕生日月別データ一覧</h2>

  <button onclick="location.href='index.html'">← 登録ページに戻る</button>

  <label for="monthSelect">表示月</label>
  <select id="monthSelect"></select>

  <div id="dataList"></div>

  <script>
    const monthSelect = document.getElementById("monthSelect");
    const now = new Date();
    const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

    // 7ヶ月前から7ヶ月後までの選択肢
    for (let i = -6; i <= 6; i++) {
      const temp = new Date(now.getFullYear(), now.getMonth() + i, 1);
      const yyyyMM = `${temp.getFullYear()}-${String(temp.getMonth() + 1).padStart(2, '0')}`;
      const label = `${temp.getFullYear()}年${temp.getMonth() + 1}月`;
      monthSelect.innerHTML += `<option value="${yyyyMM}" ${yyyyMM === currentMonth ? "selected" : ""}>${label}</option>`;
    }

    fetchData(currentMonth);

    monthSelect.addEventListener("change", function () {
      fetchData(this.value);
    });

    function fetchData(month) {
      const url = "https://script.google.com/macros/s/AKfycbxNzV8T9tJIDQ3Uff-R4lXgrcPGXNRSYdAnwHo50Esd7zHlJmhXH-IygtSSg4itxlIBqg/exec?month=" + month;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("dataList");
          if (!data || data.length === 0) {
            container.innerHTML = "<p>データがありません。</p>";
            return;
          }

          const listHtml = data.map(row =>
            `<li>${row.date} - ${row.text}</li>`
          ).join("");

          container.innerHTML = `<ul>${listHtml}</ul>`;
        })
        .catch(() => {
          document.getElementById("dataList").innerHTML = "<p>読み込みに失敗しました。</p>";
        });
    }
  </script>
</body>
</html>
